<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</title>
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>

<div class="container">
  <div class="brand">
    <div class="logo"></div>
    <div>
      <h1>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h1>
      <p class="small">Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù†Ù‚Ø§Ø·</p>
    </div>
  </div>

  <div id="adsList"></div>
</div>

<nav class="bottom-nav">
  <div class="nav-wrap">
    <a class="nav-item" href="dashboard.html">ğŸ <div>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div></a>
    <a class="nav-item active" href="ads.html">ğŸ“º<div>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</div></a>
    <a class="nav-item" href="wallet.html">ğŸ‘›<div>Ù…Ø­ÙØ¸ØªÙŠ</div></a>
    <a class="nav-item" href="profile.html">ğŸ‘¤<div>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</div></a>
  </div>
</nav>

<script type="module">
import { supabase } from "./assets/supabaseClient.js";

const { data: { user } } = await supabase.auth.getUser();
if (!user) window.location.href = "login.html";

// Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…ÙØ¹Ù„Ø©
const { data: ads } = await supabase
  .from("ads")
  .select("*")
  .eq("is_active", true);

const box = document.getElementById("adsList");

if (!ads || ads.length === 0) {
  box.innerHTML = "<div class='card'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</div>";
} else {
  ads.forEach(ad => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <h3>${ad.title}</h3>
      <a class="btn btn-ghost" target="_blank" href="${ad.youtube_url}">
        â–¶ï¸ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
      </a>
      <div style="height:10px"></div>
      <button class="btn btn-primary">Ø£Ø®Ø° ${ad.reward_points} Ù†Ù‚Ø§Ø·</button>
    `;

    card.querySelector("button").onclick = async () => {
      // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚Ø§Ø·
      const { data: wallet } = await supabase
        .from("wallets")
        .select("points")
        .eq("user_id", user.id)
        .single();

      await supabase
        .from("wallets")
        .update({ points: wallet.points + ad.reward_points })
        .eq("user_id", user.id);

      alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø· âœ…");
      location.reload();
    };

    box.appendChild(card);
  });
}
</script>

</body>
</html>
